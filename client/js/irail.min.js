var app=angular.module("iRail",["ngResource","LocalStorageModule"]);app.config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/home.html",controller:DirectionsCtrl}).when("/route/:fromStation/:toStation",{templateUrl:"views/route.html",controller:RouteCtrl}).when("/route/:fromStation/:toStation/:dateString/:timeString/:timeSelection",{templateUrl:"views/route.html",controller:RouteCtrl}).when("/route/:fromStation/:toStation/:dateString/:timeString/:timeSelection/:selectedRoute",{templateUrl:"views/route.html",controller:RouteCtrl}).when("/train/:trainId",{templateUrl:"views/train.html",controller:TrainCtrl}).when("/station/:stationName",{templateUrl:"views/station-liveboard.html",controller:StationDetailCtrl}).otherwise({redirectTo:"/"});delete b.defaults.headers.common["X-Requested-With"];b.responseInterceptors.push("httpInterceptor");var c=function(f,d){$("#spinner").show();return f};b.defaults.transformRequest.push(c)}]);app.factory("httpInterceptor",["$q",function(a){return function(b){return b.then(function(c){$("#spinner").hide();return c},function(c){$("#spinner").hide();return a.reject(c)})}}]);app.filter("replace",function(){return function(a,d,c){var f=new RegExp(d);var b=a.replace(f,c);return b}});app.run(["$rootScope","historyService",function(a,c){a.iRailAPI="http://api.irail.be";a.parseVehicleName=function(d){return d.split(".")[2]};a.back=function(){history.back()};var b=new Prefill();b.prepare(c.get(),function(){a.prefill=b})}]);var DirectionsCtrl=["$scope","$location","utilityService","favoriteRouteService","$rootScope",function(i,c,b,h,d){var a=new Date();i.day=a.getDate();i.month=a.getMonth()+1;i.year=a.getFullYear();i.hours=a.getHours();i.minutes=a.getMinutes();i.departure="depart";i.favoriteRoutes=h.getFavorites();d.hasBackbutton=false;g();i.switchFromTo=function(){var k=i.from;i.from=i.to;i.to=k};i.searchDirections=function(){var n=b.addLeadingZeroIfNeeded(i.day);var l=b.addLeadingZeroIfNeeded(i.month);var o=i.year.toString().substr(2);var k=b.addLeadingZeroIfNeeded(i.hours);var m=b.addLeadingZeroIfNeeded(i.minutes);c.path("/route/"+i.from+"/"+i.to+"/"+n+l+o+"/"+k+m+"/"+i.departure)};i.searchStations=function(){c.path("/station/"+i.station)};i.focus=function(k,l){if(l){$("#"+k).focus()}};i.unFavorite=function(l,k){console.log("removing "+l+" - "+k);h.removeFavorite(l,k)};i.$on("favoritesChanged",function(){i.favoriteRoutes=h.getFavorites()});i.directions=function(){$("#directions").addClass("active");$("#stations").removeClass("active");$("#myrail").removeClass("active")};i.stations=function(){$("#directions").removeClass("active");$("#stations").addClass("active");$("#myrail").removeClass("active")};i.myRail=function(){$("#directions").removeClass("active");$("#stations").removeClass("active");$("#myrail").addClass("active")};function g(){if(d.prefill){if(Modernizr.geolocation){navigator.geolocation.getCurrentPosition(j,f,{enableHighAccuracy:false})}else{yepnope({load:"js/geoPosition.js",callback:function(){if(geoPosition.init()){geoPosition.getCurrentPosition(j,f,{enableHighAccuracy:false})}}})}}}function j(k){var l=d.prefill.guess(a,k.coords.longitude,k.coords.latitude);i.from=l.from;i.to=l.to;i.$apply()}function f(){console.error("geolocation not available")}}];var RouteCtrl=["$scope","$routeParams","$http","$rootScope","$location","utilityService","favoriteRouteService","historyService",function(p,n,k,l,f,d,o,c){p.toStation=n.toStation;p.fromStation=n.fromStation;l.hasBackbutton=true;if(n.dateString){var j=parseInt(n.dateString.substring(0,2));var g=parseInt(n.dateString.substring(2,4));var i=parseInt("20"+n.dateString.substring(4,6));p.routeDate=new Date(i,g-1,j);p.date=n.dateString;p.time=n.timeString;p.timesel=n.timeSelection}else{p.routeDate=new Date();p.date=d.getIrailDateString(p.routeDate);p.time=d.getIrailTimeString(p.routeDate);p.timesel="depart"}if(n.selectedRoute){p.lastRouteOpened=(n.selectedRoute=="last")}p.parseNbVias=function(s){if(s){return parseInt(s.number)}return 0};r();var a=l.iRailAPI+"/connections/?to="+n.toStation+"&from="+n.fromStation+"&date="+p.date+"&time="+p.time+"&timeSel="+p.timesel+"&format=json";k.get(a).success(function(s){p.possibleRoutes=h(s.connection)});p.open=function(u){var y=$(".list-head__collapse-btn",u.currentTarget);if(y.hasClass("opened")){return}var x=angular.element.find(".list-detail");for(var w=0;w<x.length;w++){var t=x[w];$(t).hide(500)}var z=angular.element.find(".list-head__collapse-btn");for(var w=0;w<z.length;w++){var s=z[w];$(s).removeClass("opened");$(s).addClass("closed")}var v=$(".list-detail",u.currentTarget);v.show(500);y.removeClass("closed");y.addClass("opened")};p.earlier=function(){var t=d.getIrailDateString(p.routeDate);var u=new Date(p.possibleRoutes[0].arrival.time*1000);var s=d.getIrailTimeString(u);p.lastRouteOpened=false;b(t,s,"arrive")};p.later=function(){var u=new Date(p.possibleRoutes[p.possibleRoutes.length-1].departure.time*1000);var t=d.getIrailDateString(u);var s=d.getIrailTimeString(u);p.lastRouteOpened=false;b(t,s,"depart")};p.earliest=function(){var s=d.getIrailDateString(p.routeDate);p.lastRouteOpened=false;b(s,"0300","depart")};p.latest=function(){var t=new Date(p.routeDate);t.setDate(t.getDate()+1);var s=d.getIrailDateString(t);p.lastRouteOpened=true;b(s,"0300","arrive")};p.$on("ngRepeatFinished",function(s){d.pngFallback()});p.favorite=function(){o.addFavorite(p.fromStation,p.toStation)};p.unfavorite=function(){o.removeFavorite(p.fromStation,p.toStation)};p.alreadyFavorited=function(){return o.exists(p.fromStation,p.toStation)};function h(y){for(var w=0;w<y.length;w++){var t=y[w];var s=t.arrival.direction;if(!t.vias){continue}for(var v=t.vias.via.length-1;v>=0;v--){var u=t.vias.via[v];var x=u.direction;u.direction=s;s=x}}return y}function b(v,u,s){var t="/route/"+p.fromStation+"/"+p.toStation+"/"+v+"/"+u+"/"+s;if(p.lastRouteOpened){t+="/last"}f.path(t)}function r(){var s=new Date();if(Modernizr.geolocation){navigator.geolocation.getCurrentPosition(q,m,{enableHighAccuracy:false})}else{yepnope({load:"js/geoPosition.js",callback:function(){if(geoPosition.init()){geoPosition.getCurrentPosition(q,m,{enableHighAccuracy:false})}}})}}function q(s){var u=s.coords.latitude;var t=s.coords.longitude;c.add(timestamp,p.fromStation,p.toStation,u,t)}function m(){console.error("no geolocation")}}];var StationDetailCtrl=["$scope","$rootScope","$routeParams","$http","utilityService",function StationDetailCtrl(b,a,d,f,c){b.stationName=d.stationName;a.hasBackbutton=true;url=a.iRailAPI+"/liveboard/?station="+b.stationName+"&fast=true&format=json";f.get(url).success(function(g){b.liveboard=g.departures});b.$on("ngRepeatFinished",function(){c.pngFallback()})}];var TrainCtrl=["$scope","$routeParams","$http","$rootScope","utilityService",function(b,f,g,a,d){b.trainNumber=f.trainId;a.hasBackbutton=true;var c=a.iRailAPI+"/vehicle/?id="+f.trainId+"&fast=true&format=json";g.get(c).success(function(h){b.stops=h.stops});b.$on("ngRepeatFinished",function(){d.pngFallback()})}];app.directive("autoComplete",["$timeout","stationService",function(c,b){var a=function(g,f,d){f.autocomplete({source:g,minLength:2,select:function(){c(function(){f.trigger("input");f.change()},0);d.$apply()}})};return function(d,f){b.getResource(function(g){a(g,f,d)})}}]);app.directive("onFinishRender",["$timeout",function(a){return{restrict:"A",link:function(d,c,b){if(d.$last===true){a(function(){d.$emit("ngRepeatFinished")})}}}}]);app.directive("onEnter",function(){return function(c,b,a){b.bind("keydown keypress",function(d){if(d.which===13){b.trigger("input");c.$apply(function(){c.$eval(a.onEnter)})}})}});var angularLocalStorage=angular.module("LocalStorageModule",[]);angularLocalStorage.constant("prefix","iRailApp");angularLocalStorage.constant("cookie",{expiry:30,path:"/"});angularLocalStorage.service("localStorageService",["$rootScope","prefix","cookie",function($rootScope,prefix,cookie){if(prefix.substr(-1)!=="."){prefix=!!prefix?prefix+".":""}var browserSupportsLocalStorage=function(){try{return("localStorage" in window&&window.localStorage!==null)}catch(e){$rootScope.$broadcast("LocalStorageModule.notification.error",e.message);return false}};var addToLocalStorage=function(key,value){if(!browserSupportsLocalStorage()){$rootScope.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return addToCookies(key,value)}if(!value&&value!==0&&value!==""){return false}try{localStorage.setItem(prefix+key,value)}catch(e){$rootScope.$broadcast("LocalStorageModule.notification.error",e.message);return addToCookies(key,value)}return true};var getFromLocalStorage=function(key){if(!browserSupportsLocalStorage()){$rootScope.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return getFromCookies(key)}var item=localStorage.getItem(prefix+key);if(!item){return null}return item};var removeFromLocalStorage=function(key){if(!browserSupportsLocalStorage()){$rootScope.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return removeFromCookies(key)}try{localStorage.removeItem(prefix+key)}catch(e){$rootScope.$broadcast("LocalStorageModule.notification.error",e.message);return removeFromCookies(key)}return true};var clearAllFromLocalStorage=function(){if(!browserSupportsLocalStorage()){$rootScope.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return clearAllFromCookies()}var prefixLength=prefix.length;for(var key in localStorage){if(key.substr(0,prefixLength)===prefix){try{removeFromLocalStorage(key.substr(prefixLength))}catch(e){$rootScope.$broadcast("LocalStorageModule.notification.error",e.message);return clearAllFromCookies()}}}return true};var browserSupportsCookies=function(){try{return navigator.cookieEnabled||("cookie" in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1))}catch(e){$rootScope.$broadcast("LocalStorageModule.notification.error",e.message);return false}};var addToCookies=function(key,value){if(typeof value=="undefined"){return false}if(!browserSupportsCookies()){$rootScope.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED");return false}try{var expiry="",expiryDate=new Date();if(value===null){cookie.expiry=-1;value=""}if(cookie.expiry!==0){expiryDate.setTime(expiryDate.getTime()+(cookie.expiry*24*60*60*1000));expiry=", expires="+expiryDate.toGMTString()}if(!!key){document.cookie=prefix+key+"="+encodeURIComponent(value)+expiry+", path="+cookie.path}}catch(e){$rootScope.$broadcast("LocalStorageModule.notification.error",e.message);return false}return true};var getFromCookies=function(key){if(!browserSupportsCookies()){$rootScope.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED");return false}var cookies=document.cookie.split(",");for(var i=0;i<cookies.length;i++){var thisCookie=cookies[i];while(thisCookie.charAt(0)==" "){thisCookie=thisCookie.substring(1,thisCookie.length)}if(thisCookie.indexOf(prefix+key+"=")===0){return decodeURIComponent(thisCookie.substring(prefix.length+key.length+1,thisCookie.length))}}return null};var removeFromCookies=function(key){addToCookies(key,null)};var clearAllFromCookies=function(){var thisCookie=null,thisKey=null;var prefixLength=prefix.length;var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){thisCookie=cookies[i];while(thisCookie.charAt(0)==" "){thisCookie=thisCookie.substring(1,thisCookie.length)}key=thisCookie.substring(prefixLength,thisCookie.indexOf("="));removeFromCookies(key)}};var stringifyJson=function(vContent,isJSON){if(typeof vContent==="string"&&vContent.charAt(0)!=="{"&&!isJSON){return vContent}if(vContent instanceof Object){var sOutput="";if(vContent.constructor===Array){for(var nId=0;nId<vContent.length;sOutput+=this.stringifyJson(vContent[nId],true)+",",nId++){}return"["+sOutput.substr(0,sOutput.length-1)+"]"}if(vContent.toString!==Object.prototype.toString){return'"'+vContent.toString().replace(/"/g,"\\$&")+'"'}for(var sProp in vContent){sOutput+='"'+sProp.replace(/"/g,"\\$&")+'":'+this.stringifyJson(vContent[sProp],true)+","}return"{"+sOutput.substr(0,sOutput.length-1)+"}"}return typeof vContent==="string"?'"'+vContent.replace(/"/g,"\\$&")+'"':String(vContent)};var parseJson=function(sJSON){if(sJSON.charAt(0)!=="{"){return sJSON}return eval("("+sJSON+")")};return{isSupported:browserSupportsLocalStorage,add:addToLocalStorage,get:getFromLocalStorage,remove:removeFromLocalStorage,clearAll:clearAllFromLocalStorage,stringifyJson:stringifyJson,parseJson:parseJson,cookie:{add:addToCookies,get:getFromCookies,remove:removeFromCookies,clearAll:clearAllFromCookies}}}]);(function e(b,g,d){function c(k,i){if(!g[k]){if(!b[k]){var h=typeof require=="function"&&require;if(!i&&h){return h(k,!0)}if(a){return a(k,!0)}throw new Error("Cannot find module '"+k+"'")}var j=g[k]={exports:{}};b[k][0].call(j.exports,function(l){var m=b[k][1][l];return c(m?m:l)},j,j.exports,e,b,g,d)}return g[k].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(c,d,b){var a=c("brain");Prefill=function(f){this.options=f||{};this.stop_areas={};this.history=[];this.lc=[];this.net={};this.normalizeInput=function(i,g){var h=parseInt(i.getHours()+""+i.getMinutes()/60*100);return{day:i.getDay()/6,time:h/2400,longitude:(g.longitude+90)/180,latitude:(g.latitude+90)/180,}};this.prepare=function(g,o){this.history=g;this.net=new a.NeuralNetwork();for(var k=0;k<this.history.length;k++){var n=this.history[k].from;var m=this.history[k].to;var l=new Date(this.history[k].datetime);var j={};j[n+"|"+m]=1;this.lc[k]={input:this.normalizeInput(l,this.history[k].location),output:j}}if(this.options.logging){console.info("Metrics on how good we trained our network:")}var h=this.net.train(this.lc,{errorThresh:0.05,iterations:20000,log:this.options.logging,logPeriod:10});if(this.options.logging){console.info(h)}o()};this.guess=function(m,k,l){var i=this.net.run(this.normalizeInput(m,{longitude:k,latitude:l}));console.log("Result of the neural network:");console.log(i);var g=0;var j=[];for(var h in i){if(i[h]>g){j=h.split("|");g=i[h]}}return{from:j[0],to:j[1]}}};d.exports=Prefill},{brain:2}],2:[function(b,c,a){a.NeuralNetwork=b("./neuralnetwork").NeuralNetwork;a.crossValidate=b("./cross-validate")},{"./cross-validate":3,"./neuralnetwork":5}],3:[function(d,g,b){var c=d("underscore")._;function f(i,h,l,q,o){var n=new i(h);var s=Date.now();var j=n.train(q,l);var p=Date.now();var k=n.test(o);var r=Date.now();var m=c(k).extend({trainTime:p-s,testTime:r-p,iterations:j.iterations,trainError:j.error,learningRate:n.learningRate,hidden:n.hiddenSizes,network:n.toJSON()});return m}g.exports=function a(i,n,h,l,j){j=j||4;var r=n.length/j;n=c(n).sortBy(function(){return Math.random()});var p={error:0,trainTime:0,testTime:0,iterations:0,trainError:0};var o={truePos:0,trueNeg:0,falsePos:0,falseNeg:0,total:0};var q=[];var m=c.range(j).map(function(t){var s=c(n).clone();var v=s.splice(t*r,r);var u=s;var k=f(i,h,l,u,v);c(p).each(function(x,w){p[w]=x+k[w]});c(o).each(function(x,w){o[w]=x+k[w]});q.push(k.misclasses);return k});c(p).each(function(s,k){p[k]=s/j});o.precision=o.truePos/(o.truePos+o.falsePos);o.recall=o.truePos/(o.truePos+o.falseNeg);o.accuracy=(o.trueNeg+o.truePos)/o.total;o.testSize=r;o.trainSize=n.length-r;return{avgs:p,stats:o,sets:m,misclasses:c(q).flatten()}}},{underscore:6}],4:[function(d,g,a){var c=d("underscore");function b(j){var k=c(j).reduce(function(l,m){return c(l).extend(m)},{});return i(k)}function i(m){var l={};var j=0;for(var k in m){l[k]=j++}return l}function f(l,k){var m=[];for(var j in l){m[l[j]]=k[j]||0}return m}function h(l,m){var k={};for(var j in l){k[j]=m[l[j]]}return k}g.exports={buildLookup:b,lookupFromHash:i,toArray:f,toHash:h}},{underscore:6}],5:[function(d,a,g){var j=d("underscore"),b=d("./lookup");var h=function(l){l=l||{};this.learningRate=l.learningRate||0.3;this.momentum=l.momentum||0.1;this.hiddenSizes=l.hiddenLayers};h.prototype={initialize:function(o){this.sizes=o;this.outputLayer=this.sizes.length-1;this.biases=[];this.weights=[];this.outputs=[];this.deltas=[];this.changes=[];this.errors=[];for(var m=0;m<=this.outputLayer;m++){var l=this.sizes[m];this.deltas[m]=c(l);this.errors[m]=c(l);this.outputs[m]=c(l);if(m>0){this.biases[m]=k(l);this.weights[m]=new Array(l);this.changes[m]=new Array(l);for(var n=0;n<l;n++){var p=this.sizes[m-1];this.weights[m][n]=k(p);this.changes[m][n]=c(p)}}}},run:function(m){if(this.inputLookup){m=b.toArray(this.inputLookup,m)}var l=this.runInput(m);if(this.outputLookup){l=b.toHash(this.outputLookup,l)}return l},runInput:function(n){this.outputs[0]=n;for(var o=1;o<=this.outputLayer;o++){for(var r=0;r<this.sizes[o];r++){var q=this.weights[o][r];var p=this.biases[o][r];for(var m=0;m<q.length;m++){p+=q[m]*n[m]}this.outputs[o][r]=1/(1+Math.exp(-p))}var l=n=this.outputs[o]}return l},train:function(s,A){s=this.formatData(s);A=A||{};var m=A.iterations||20000;var l=A.errorThresh||0.005;var q=A.log||false;var t=A.logPeriod||10;var y=A.callback;var B=A.callbackPeriod||10;var v=s[0].input.length;var o=s[0].output.length;var u=this.hiddenSizes;if(!u){u=[Math.max(3,Math.floor(v/2))]}var z=j([v,u,o]).flatten();this.initialize(z);var x=1;for(var r=0;r<m&&x>l;r++){var w=0;for(var p=0;p<s.length;p++){var n=this.trainPattern(s[p].input,s[p].output);w+=n}x=w/s.length;if(q&&(r%t==0)){console.log("iterations:",r,"training error:",x)}if(y&&(r%B==0)){y({error:x,iterations:r})}}return{error:x,iterations:r}},trainPattern:function(l,n){this.runInput(l);this.calculateDeltas(n);this.adjustWeights();var m=f(this.errors[this.outputLayer]);return m},calculateDeltas:function(r){for(var o=this.outputLayer;o>=0;o--){for(var p=0;p<this.sizes[o];p++){var m=this.outputs[o][p];var n=0;if(o==this.outputLayer){n=r[p]-m}else{var q=this.deltas[o+1];for(var l=0;l<q.length;l++){n+=q[l]*this.weights[o+1][l][p]}}this.errors[o][p]=n;this.deltas[o][p]=n*m*(1-m)}}},adjustWeights:function(){for(var n=1;n<=this.outputLayer;n++){var l=this.outputs[n-1];for(var o=0;o<this.sizes[n];o++){var q=this.deltas[n][o];for(var m=0;m<l.length;m++){var p=this.changes[n][o][m];p=(this.learningRate*q*l[m])+(this.momentum*p);this.changes[n][o][m]=p;this.weights[n][o][m]+=p}this.biases[n][o]+=this.learningRate*q}}},formatData:function(l){if(!j(l[0].input).isArray()){if(!this.inputLookup){this.inputLookup=b.buildLookup(j(l).pluck("input"))}l=l.map(function(m){var n=b.toArray(this.inputLookup,m.input);return j(j(m).clone()).extend({input:n})},this)}if(!j(l[0].output).isArray()){if(!this.outputLookup){this.outputLookup=b.buildLookup(j(l).pluck("output"))}l=l.map(function(m){var n=b.toArray(this.outputLookup,m.output);return j(j(m).clone()).extend({output:n})},this)}return l},test:function(B,z){B=this.formatData(B);z=z||0.5;var r=B[0].output.length==1;var C=0,u=0,n=0,l=0;var x=[];var m=0;for(var v=0;v<B.length;v++){var p=this.runInput(B[v].input);var A=B[v].output;var s,o;if(r){s=p[0]>z?1:0;o=A[0]}else{s=p.indexOf(j(p).max());o=A.indexOf(j(A).max())}if(s!=o){var w=B[v];j(w).extend({actual:s,expected:o});x.push(w)}if(r){if(s==0&&o==0){l++}else{if(s==1&&o==1){n++}else{if(s==0&&o==1){u++}else{if(s==1&&o==0){C++}}}}}var q=p.map(function(E,D){return A[D]-E});m+=f(q)}var t=m/B.length;var y={error:t,misclasses:x};if(r){j(y).extend({trueNeg:l,truePos:n,falseNeg:u,falsePos:C,total:B.length,precision:n/(n+C),recall:n/(n+u),accuracy:(l+n)/B.length})}return y},toJSON:function(){var r=[];for(var p=0;p<=this.outputLayer;p++){r[p]={};var m;if(p==0&&this.inputLookup){m=j(this.inputLookup).keys()}else{if(p==this.outputLayer&&this.outputLookup){m=j(this.outputLookup).keys()}else{m=j.range(0,this.sizes[p])}}for(var o=0;o<m.length;o++){var q=m[o];r[p][q]={};if(p>0){r[p][q].bias=this.biases[p][o];r[p][q].weights={};for(var l in r[p-1]){var n=l;if(p==1&&this.inputLookup){n=this.inputLookup[l]}r[p][q].weights[l]=this.weights[p][o][n]}}}}return{layers:r}},fromJSON:function(q){var p=q.layers.length;this.outputLayer=p-1;this.sizes=new Array(p);this.weights=new Array(p);this.biases=new Array(p);this.outputs=new Array(p);for(var o=0;o<=this.outputLayer;o++){var n=q.layers[o];if(o==0&&!n[0]){this.inputLookup=b.lookupFromHash(n)}else{if(o==this.outputLayer&&!n[0]){this.outputLookup=b.lookupFromHash(n)}}var l=j(n).keys();this.sizes[o]=l.length;this.weights[o]=[];this.biases[o]=[];this.outputs[o]=[];for(var m in l){var r=l[m];this.biases[o][m]=n[r].bias;this.weights[o][m]=j(n[r].weights).toArray()}}return this},toFunction:function(){var l=this.toJSON();return new Function("input","  var net = "+JSON.stringify(l)+";\n\n  for (var i = 1; i < net.layers.length; i++) {\n    var layer = net.layers[i];\n    var output = {};\n    \n    for (var id in layer) {\n      var node = layer[id];\n      var sum = node.bias;\n      \n      for (var iid in node.weights) {\n        sum += node.weights[iid] * input[iid];\n      }\n      output[id] = (1 / (1 + Math.exp(-sum)));\n    }\n    input = output;\n  }\n  return output;")}};function i(){return Math.random()*0.4-0.2}function c(m){var n=new Array(m);for(var l=0;l<m;l++){n[l]=0}return n}function k(m){var n=new Array(m);for(var l=0;l<m;l++){n[l]=i()}return n}function f(n){var m=0;for(var l=0;l<n.length;l++){m+=Math.pow(n[l],2)}return m/n.length}g.NeuralNetwork=h},{"./lookup":4,underscore:6}],6:[function(b,c,a){(function(){var A=this;var o=A._;var H={};var G=Array.prototype,j=Object.prototype,v=Function.prototype;var L=G.push,s=G.slice,C=G.concat,h=j.toString,n=j.hasOwnProperty;var P=G.forEach,u=G.map,I=G.reduce,g=G.reduceRight,f=G.filter,F=G.every,t=G.some,r=G.indexOf,p=G.lastIndexOf,y=Array.isArray,i=Object.keys,J=v.bind;var Q=function(R){if(R instanceof Q){return R}if(!(this instanceof Q)){return new Q(R)}this._wrapped=R};if(typeof a!=="undefined"){if(typeof c!=="undefined"&&c.exports){a=c.exports=Q}a._=Q}else{A._=Q}Q.VERSION="1.5.1";var M=Q.each=Q.forEach=function(W,V,U){if(W==null){return}if(P&&W.forEach===P){W.forEach(V,U)}else{if(W.length===+W.length){for(var T=0,R=W.length;T<R;T++){if(V.call(U,W[T],T,W)===H){return}}}else{for(var S in W){if(Q.has(W,S)){if(V.call(U,W[S],S,W)===H){return}}}}}};Q.map=Q.collect=function(U,T,S){var R=[];if(U==null){return R}if(u&&U.map===u){return U.map(T,S)}M(U,function(X,V,W){R.push(T.call(S,X,V,W))});return R};var k="Reduce of empty array with no initial value";Q.reduce=Q.foldl=Q.inject=function(V,U,R,T){var S=arguments.length>2;if(V==null){V=[]}if(I&&V.reduce===I){if(T){U=Q.bind(U,T)}return S?V.reduce(U,R):V.reduce(U)}M(V,function(Y,W,X){if(!S){R=Y;S=true}else{R=U.call(T,R,Y,W,X)}});if(!S){throw new TypeError(k)}return R};Q.reduceRight=Q.foldr=function(X,U,R,T){var S=arguments.length>2;if(X==null){X=[]}if(g&&X.reduceRight===g){if(T){U=Q.bind(U,T)}return S?X.reduceRight(U,R):X.reduceRight(U)}var W=X.length;if(W!==+W){var V=Q.keys(X);W=V.length}M(X,function(aa,Y,Z){Y=V?V[--W]:--W;if(!S){R=X[Y];S=true}else{R=U.call(T,R,X[Y],Y,Z)}});if(!S){throw new TypeError(k)}return R};Q.find=Q.detect=function(U,T,S){var R;E(U,function(X,V,W){if(T.call(S,X,V,W)){R=X;return true}});return R};Q.filter=Q.select=function(U,T,S){var R=[];if(U==null){return R}if(f&&U.filter===f){return U.filter(T,S)}M(U,function(X,V,W){if(T.call(S,X,V,W)){R.push(X)}});return R};Q.reject=function(T,S,R){return Q.filter(T,function(W,U,V){return !S.call(R,W,U,V)},R)};Q.every=Q.all=function(U,T,S){T||(T=Q.identity);var R=true;if(U==null){return R}if(F&&U.every===F){return U.every(T,S)}M(U,function(X,V,W){if(!(R=R&&T.call(S,X,V,W))){return H}});return !!R};var E=Q.some=Q.any=function(U,T,S){T||(T=Q.identity);var R=false;if(U==null){return R}if(t&&U.some===t){return U.some(T,S)}M(U,function(X,V,W){if(R||(R=T.call(S,X,V,W))){return H}});return !!R};Q.contains=Q.include=function(S,R){if(S==null){return false}if(r&&S.indexOf===r){return S.indexOf(R)!=-1}return E(S,function(T){return T===R})};Q.invoke=function(T,U){var R=s.call(arguments,2);var S=Q.isFunction(U);return Q.map(T,function(V){return(S?U:V[U]).apply(V,R)})};Q.pluck=function(S,R){return Q.map(S,function(T){return T[R]})};Q.where=function(S,R,T){if(Q.isEmpty(R)){return T?void 0:[]}return Q[T?"find":"filter"](S,function(V){for(var U in R){if(R[U]!==V[U]){return false}}return true})};Q.findWhere=function(S,R){return Q.where(S,R,true)};Q.max=function(U,T,S){if(!T&&Q.isArray(U)&&U[0]===+U[0]&&U.length<65535){return Math.max.apply(Math,U)}if(!T&&Q.isEmpty(U)){return -Infinity}var R={computed:-Infinity,value:-Infinity};M(U,function(Y,V,X){var W=T?T.call(S,Y,V,X):Y;W>R.computed&&(R={value:Y,computed:W})});return R.value};Q.min=function(U,T,S){if(!T&&Q.isArray(U)&&U[0]===+U[0]&&U.length<65535){return Math.min.apply(Math,U)}if(!T&&Q.isEmpty(U)){return Infinity}var R={computed:Infinity,value:Infinity};M(U,function(Y,V,X){var W=T?T.call(S,Y,V,X):Y;W<R.computed&&(R={value:Y,computed:W})});return R.value};Q.shuffle=function(U){var T;var S=0;var R=[];M(U,function(V){T=Q.random(S++);R[S-1]=R[T];R[T]=V});return R};var d=function(R){return Q.isFunction(R)?R:function(S){return S[R]}};Q.sortBy=function(U,T,R){var S=d(T);return Q.pluck(Q.map(U,function(X,V,W){return{value:X,index:V,criteria:S.call(R,X,V,W)}}).sort(function(Y,X){var W=Y.criteria;var V=X.criteria;if(W!==V){if(W>V||W===void 0){return 1}if(W<V||V===void 0){return -1}}return Y.index<X.index?-1:1}),"value")};var x=function(W,V,S,U){var R={};var T=d(V==null?Q.identity:V);M(W,function(Z,X){var Y=T.call(S,Z,X,W);U(R,Y,Z)});return R};Q.groupBy=function(T,S,R){return x(T,S,R,function(U,V,W){(Q.has(U,V)?U[V]:(U[V]=[])).push(W)})};Q.countBy=function(T,S,R){return x(T,S,R,function(U,V){if(!Q.has(U,V)){U[V]=0}U[V]++})};Q.sortedIndex=function(Y,X,U,T){U=U==null?Q.identity:d(U);var W=U.call(T,X);var R=0,V=Y.length;while(R<V){var S=(R+V)>>>1;U.call(T,Y[S])<W?R=S+1:V=S}return R};Q.toArray=function(R){if(!R){return[]}if(Q.isArray(R)){return s.call(R)}if(R.length===+R.length){return Q.map(R,Q.identity)}return Q.values(R)};Q.size=function(R){if(R==null){return 0}return(R.length===+R.length)?R.length:Q.keys(R).length};Q.first=Q.head=Q.take=function(T,S,R){if(T==null){return void 0}return(S!=null)&&!R?s.call(T,0,S):T[0]};Q.initial=function(T,S,R){return s.call(T,0,T.length-((S==null)||R?1:S))};Q.last=function(T,S,R){if(T==null){return void 0}if((S!=null)&&!R){return s.call(T,Math.max(T.length-S,0))}else{return T[T.length-1]}};Q.rest=Q.tail=Q.drop=function(T,S,R){return s.call(T,(S==null)||R?1:S)};Q.compact=function(R){return Q.filter(R,Q.identity)};var B=function(S,T,R){if(T&&Q.every(S,Q.isArray)){return C.apply(R,S)}M(S,function(U){if(Q.isArray(U)||Q.isArguments(U)){T?L.apply(R,U):B(U,T,R)}else{R.push(U)}});return R};Q.flatten=function(S,R){return B(S,R,[])};Q.without=function(R){return Q.difference(R,s.call(arguments,1))};Q.uniq=Q.unique=function(X,W,V,U){if(Q.isFunction(W)){U=V;V=W;W=false}var S=V?Q.map(X,V,U):X;var T=[];var R=[];M(S,function(Z,Y){if(W?(!Y||R[R.length-1]!==Z):!Q.contains(R,Z)){R.push(Z);T.push(X[Y])}});return T};Q.union=function(){return Q.uniq(Q.flatten(arguments,true))};Q.intersection=function(S){var R=s.call(arguments,1);return Q.filter(Q.uniq(S),function(T){return Q.every(R,function(U){return Q.indexOf(U,T)>=0})})};Q.difference=function(S){var R=C.apply(G,s.call(arguments,1));return Q.filter(S,function(T){return !Q.contains(R,T)})};Q.zip=function(){var T=Q.max(Q.pluck(arguments,"length").concat(0));var S=new Array(T);for(var R=0;R<T;R++){S[R]=Q.pluck(arguments,""+R)}return S};Q.object=function(V,T){if(V==null){return{}}var R={};for(var U=0,S=V.length;U<S;U++){if(T){R[V[U]]=T[U]}else{R[V[U][0]]=V[U][1]}}return R};Q.indexOf=function(V,T,U){if(V==null){return -1}var S=0,R=V.length;if(U){if(typeof U=="number"){S=(U<0?Math.max(0,R+U):U)}else{S=Q.sortedIndex(V,T);return V[S]===T?S:-1}}if(r&&V.indexOf===r){return V.indexOf(T,U)}for(;S<R;S++){if(V[S]===T){return S}}return -1};Q.lastIndexOf=function(V,T,U){if(V==null){return -1}var R=U!=null;if(p&&V.lastIndexOf===p){return R?V.lastIndexOf(T,U):V.lastIndexOf(T)}var S=(R?U:V.length);while(S--){if(V[S]===T){return S}}return -1};Q.range=function(W,U,V){if(arguments.length<=1){U=W||0;W=0}V=arguments[2]||1;var S=Math.max(Math.ceil((U-W)/V),0);var R=0;var T=new Array(S);while(R<S){T[R++]=W;W+=V}return T};var K=function(){};Q.bind=function(U,S){var R,T;if(J&&U.bind===J){return J.apply(U,s.call(arguments,1))}if(!Q.isFunction(U)){throw new TypeError}R=s.call(arguments,2);return T=function(){if(!(this instanceof T)){return U.apply(S,R.concat(s.call(arguments)))}K.prototype=U.prototype;var W=new K;K.prototype=null;var V=U.apply(W,R.concat(s.call(arguments)));if(Object(V)===V){return V}return W}};Q.partial=function(S){var R=s.call(arguments,1);return function(){return S.apply(this,R.concat(s.call(arguments)))}};Q.bindAll=function(S){var R=s.call(arguments,1);if(R.length===0){throw new Error("bindAll must be passed function names")}M(R,function(T){S[T]=Q.bind(S[T],S)});return S};Q.memoize=function(T,S){var R={};S||(S=Q.identity);return function(){var U=S.apply(this,arguments);return Q.has(R,U)?R[U]:(R[U]=T.apply(this,arguments))}};Q.delay=function(S,T){var R=s.call(arguments,2);return setTimeout(function(){return S.apply(null,R)},T)};Q.defer=function(R){return Q.delay.apply(Q,[R,1].concat(s.call(arguments,1)))};Q.throttle=function(S,U,Y){var R,W,Z;var X=null;var V=0;Y||(Y={});var T=function(){V=Y.leading===false?0:new Date;X=null;Z=S.apply(R,W)};return function(){var aa=new Date;if(!V&&Y.leading===false){V=aa}var ab=U-(aa-V);R=this;W=arguments;if(ab<=0){clearTimeout(X);X=null;V=aa;Z=S.apply(R,W)}else{if(!X&&Y.trailing!==false){X=setTimeout(T,ab)}}return Z}};Q.debounce=function(T,V,S){var R;var U=null;return function(){var Z=this,Y=arguments;var X=function(){U=null;if(!S){R=T.apply(Z,Y)}};var W=S&&!U;clearTimeout(U);U=setTimeout(X,V);if(W){R=T.apply(Z,Y)}return R}};Q.once=function(T){var R=false,S;return function(){if(R){return S}R=true;S=T.apply(this,arguments);T=null;return S}};Q.wrap=function(R,S){return function(){var T=[R];L.apply(T,arguments);return S.apply(this,T)}};Q.compose=function(){var R=arguments;return function(){var S=arguments;for(var T=R.length-1;T>=0;T--){S=[R[T].apply(this,S)]}return S[0]}};Q.after=function(S,R){return function(){if(--S<1){return R.apply(this,arguments)}}};Q.keys=i||function(T){if(T!==Object(T)){throw new TypeError("Invalid object")}var S=[];for(var R in T){if(Q.has(T,R)){S.push(R)}}return S};Q.values=function(T){var R=[];for(var S in T){if(Q.has(T,S)){R.push(T[S])}}return R};Q.pairs=function(T){var S=[];for(var R in T){if(Q.has(T,R)){S.push([R,T[R]])}}return S};Q.invert=function(T){var R={};for(var S in T){if(Q.has(T,S)){R[T[S]]=S}}return R};Q.functions=Q.methods=function(T){var S=[];for(var R in T){if(Q.isFunction(T[R])){S.push(R)}}return S.sort()};Q.extend=function(R){M(s.call(arguments,1),function(S){if(S){for(var T in S){R[T]=S[T]}}});return R};Q.pick=function(S){var T={};var R=C.apply(G,s.call(arguments,1));M(R,function(U){if(U in S){T[U]=S[U]}});return T};Q.omit=function(T){var U={};var S=C.apply(G,s.call(arguments,1));for(var R in T){if(!Q.contains(S,R)){U[R]=T[R]}}return U};Q.defaults=function(R){M(s.call(arguments,1),function(S){if(S){for(var T in S){if(R[T]===void 0){R[T]=S[T]}}}});return R};Q.clone=function(R){if(!Q.isObject(R)){return R}return Q.isArray(R)?R.slice():Q.extend({},R)};Q.tap=function(S,R){R(S);return S};var N=function(Y,X,S,T){if(Y===X){return Y!==0||1/Y==1/X}if(Y==null||X==null){return Y===X}if(Y instanceof Q){Y=Y._wrapped}if(X instanceof Q){X=X._wrapped}var V=h.call(Y);if(V!=h.call(X)){return false}switch(V){case"[object String]":return Y==String(X);case"[object Number]":return Y!=+Y?X!=+X:(Y==0?1/Y==1/X:Y==+X);case"[object Date]":case"[object Boolean]":return +Y==+X;case"[object RegExp]":return Y.source==X.source&&Y.global==X.global&&Y.multiline==X.multiline&&Y.ignoreCase==X.ignoreCase}if(typeof Y!="object"||typeof X!="object"){return false}var R=S.length;while(R--){if(S[R]==Y){return T[R]==X}}var W=Y.constructor,U=X.constructor;if(W!==U&&!(Q.isFunction(W)&&(W instanceof W)&&Q.isFunction(U)&&(U instanceof U))){return false}S.push(Y);T.push(X);var ab=0,aa=true;if(V=="[object Array]"){ab=Y.length;aa=ab==X.length;if(aa){while(ab--){if(!(aa=N(Y[ab],X[ab],S,T))){break}}}}else{for(var Z in Y){if(Q.has(Y,Z)){ab++;if(!(aa=Q.has(X,Z)&&N(Y[Z],X[Z],S,T))){break}}}if(aa){for(Z in X){if(Q.has(X,Z)&&!(ab--)){break}}aa=!ab}}S.pop();T.pop();return aa};Q.isEqual=function(S,R){return N(S,R,[],[])};Q.isEmpty=function(S){if(S==null){return true}if(Q.isArray(S)||Q.isString(S)){return S.length===0}for(var R in S){if(Q.has(S,R)){return false}}return true};Q.isElement=function(R){return !!(R&&R.nodeType===1)};Q.isArray=y||function(R){return h.call(R)=="[object Array]"};Q.isObject=function(R){return R===Object(R)};M(["Arguments","Function","String","Number","Date","RegExp"],function(R){Q["is"+R]=function(S){return h.call(S)=="[object "+R+"]"}});if(!Q.isArguments(arguments)){Q.isArguments=function(R){return !!(R&&Q.has(R,"callee"))}}if(typeof(/./)!=="function"){Q.isFunction=function(R){return typeof R==="function"}}Q.isFinite=function(R){return isFinite(R)&&!isNaN(parseFloat(R))};Q.isNaN=function(R){return Q.isNumber(R)&&R!=+R};Q.isBoolean=function(R){return R===true||R===false||h.call(R)=="[object Boolean]"};Q.isNull=function(R){return R===null};Q.isUndefined=function(R){return R===void 0};Q.has=function(S,R){return n.call(S,R)};Q.noConflict=function(){A._=o;return this};Q.identity=function(R){return R};Q.times=function(V,U,T){var R=Array(Math.max(0,V));for(var S=0;S<V;S++){R[S]=U.call(T,S)}return R};Q.random=function(S,R){if(R==null){R=S;S=0}return S+Math.floor(Math.random()*(R-S+1))};var q={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};q.unescape=Q.invert(q.escape);var O={escape:new RegExp("["+Q.keys(q.escape).join("")+"]","g"),unescape:new RegExp("("+Q.keys(q.unescape).join("|")+")","g")};Q.each(["escape","unescape"],function(R){Q[R]=function(S){if(S==null){return""}return(""+S).replace(O[R],function(T){return q[R][T]})}});Q.result=function(R,T){if(R==null){return void 0}var S=R[T];return Q.isFunction(S)?S.call(R):S};Q.mixin=function(R){M(Q.functions(R),function(S){var T=Q[S]=R[S];Q.prototype[S]=function(){var U=[this._wrapped];L.apply(U,arguments);return w.call(this,T.apply(Q,U))}})};var D=0;Q.uniqueId=function(R){var S=++D+"";return R?R+S:S};Q.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/;var l={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var m=/\\|'|\r|\n|\t|\u2028|\u2029/g;Q.template=function(Z,U,T){var S;T=Q.defaults({},T,Q.templateSettings);var V=new RegExp([(T.escape||z).source,(T.interpolate||z).source,(T.evaluate||z).source].join("|")+"|$","g");var W=0;var R="__p+='";Z.replace(V,function(ab,ac,aa,ae,ad){R+=Z.slice(W,ad).replace(m,function(af){return"\\"+l[af]});if(ac){R+="'+\n((__t=("+ac+"))==null?'':_.escape(__t))+\n'"}if(aa){R+="'+\n((__t=("+aa+"))==null?'':__t)+\n'"}if(ae){R+="';\n"+ae+"\n__p+='"}W=ad+ab.length;return ab});R+="';\n";if(!T.variable){R="with(obj||{}){\n"+R+"}\n"}R="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+R+"return __p;\n";try{S=new Function(T.variable||"obj","_",R)}catch(X){X.source=R;throw X}if(U){return S(U,Q)}var Y=function(aa){return S.call(this,aa,Q)};Y.source="function("+(T.variable||"obj")+"){\n"+R+"}";return Y};Q.chain=function(R){return Q(R).chain()};var w=function(R){return this._chain?Q(R).chain():R};Q.mixin(Q);M(["pop","push","reverse","shift","sort","splice","unshift"],function(R){var S=G[R];Q.prototype[R]=function(){var T=this._wrapped;S.apply(T,arguments);if((R=="shift"||R=="splice")&&T.length===0){delete T[0]}return w.call(this,T)}});M(["concat","join","slice"],function(R){var S=G[R];Q.prototype[R]=function(){return w.call(this,S.apply(this._wrapped,arguments))}});Q.extend(Q.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this)},{}]},{},[1]);app.factory("stationService",["$resource","$cacheFactory","$rootScope",function(d,g,b){var c=g("stationService");var a=d(b.iRailAPI+"/stations/?lang=en&format=json");return{getResource:function(i){var h=c.get("stations");if(!h){a.get(function(j){h=f(j.station);c.put("stations",h);i(h)})}else{i(h)}}};function f(l){var k=[];for(var h=0;h<l.length;h++){var j=l[h];k.push(j.name)}return k}}]);app.factory("utilityService",function(){return{addLeadingZeroIfNeeded:function(a){if(a<10){return"0"+a.toString()}return a.toString()},pngFallback:function(){if(!Modernizr.svg){(function(){var d=document.getElementsByTagName("img"),c=/.*\.svg$/,b=0,a=d.length;for(;b<a;++b){if(d[b].src.match(c)){d[b].src=d[b].src.slice(0,-3)+"png"}}})()}},getIrailDateString:function(b){var c=this.addLeadingZeroIfNeeded(b.getDate());var a=this.addLeadingZeroIfNeeded(b.getMonth()+1);var d=b.getFullYear().toString().substr(2);return c+a+d},getIrailTimeString:function(b){var a=this.addLeadingZeroIfNeeded(b.getHours());var c=this.addLeadingZeroIfNeeded(b.getMinutes());return a+c}}});app.factory("favoriteRouteService",["localStorageService","$rootScope",function(b,a){return{addFavorite:function(h,g){var c=this.get();for(var f=0;f<c.length;f++){var d=c[f];if(d.from==h&&d.to==g){return}}c.push({from:h,to:g});b.add("favoriteRoutes",JSON.stringify(c))},removeFavorite:function(h,g){var c=JSON.parse(b.get("favoriteRoutes"));if(!c){return}for(var f=0;f<c.length;f++){var d=c[f];if(d.from==h&&d.to==g){c.splice(f,1);b.add("favoriteRoutes",JSON.stringify(c));return}}a.$broadcast("favoritesChanged")},getFavorites:function(){var c=JSON.parse(b.get("favoriteRoutes"));if(!c){c=[]}return c},exists:function(h,g){var c=JSON.parse(b.get("favoriteRoutes"));if(!c){return false}for(var f=0;f<c.length;f++){var d=c[f];if(d.from==h&&d.to==g){return true}}return false}}}]);app.factory("historyService",["localStorageService",function(a){return{add:function(b,i,h,g,c){var f=this.get();var d={datetime:b,location:{longitude:c,latitude:g},from:i,to:h};f.push(d);a.add("history",JSON.stringify(f))},get:function(){var b=JSON.parse(a.get("history"));if(!b){b=[]}return b}}}]);